@use '_globals' as *;
@use 'styles/links' as *;
@use 'styles/font' as *;

@media screen {
	.MainMenu {
	}
	.MainMenu__title {
		display: none; // ok if aria-label/aria-labelledby is used!
	}
	.MainMenu__items {
	}
	.MainMenu__item {
		color: $color-suld-200;
		white-space: nowrap;
	}
	.MainMenu__item[aria-current='true'] {
		color: $color-faxafloi-100;
	}
	.MainMenu__item--home {
		@include sr-only-content-focusable();
	}

	.MainMenu__link {
		@include buttonReset();
		@include LinkStyle();
		--link-color: _inherit;
		display: block;
		width: max-content;
		font-weight: $font-weight--bold;
	}
	.MainMenu__link[aria-pressed='true'] {
		border-bottom-color: $color-faxafloi-50;
	}
	.MainMenu__link[aria-pressed='true']:focus {
		border-bottom-color: currentColor;
	}

	.MainMenu__link::before {
		@include icon();
		margin-right: prem(8);
		vertical-align: prem(-3);
	}
	.MainMenu__item--mypages > .MainMenu__link::before {
		content: $icons-user;
	}
	.MainMenu__item--search > .MainMenu__link::before {
		content: $icons-search;
	}
}

// ===========================================================================

// ===========================================================================

@media #{$mq-Hamburger} {
	$menu-speed: 300ms;
	$swimmer-speed: 500ms;

	html.before-sprinkling .MainMenu {
		display: none;
	}
	.MainMenu {
		position: relative;
		--MainMenu--offsetLeft: #{prem(64)};

		@include media('screen and (max-width: 370px)') {
			--MainMenu--offsetLeft: #{prem(16)};
		}
		@include media('screen and (max-height: 640px)') {
			--MainMenu__list--padTop: 0px;
		}
	}

	html.menu-is-active .MainMenu {
		display: block;
		visibility: hidden;
		position: fixed;
		z-index: $zIndex--header - 1;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		padding: 0 $var--grid-edge;
		padding-top: $var--Layout__header-height;
		margin-top: -100vh;
		overflow-x: hidden;
		overflow-y: auto;

		--valmundur-height: 197px;
		--valmundur-width: 536px;

		@include media($mq-phone) {
			--valmundur-height: #{between_phone(150, 197)};
		}
		@include media('screen and (max-height: 640px)') {
			--valmundur-height: #{between(100, 150, 480, 640, vh)};
			@media #{$mq-phone} {
				--valmundur-width: #{px($bp-phablet)};
			}
		}
		@include media('screen and (max-height: 480px)') {
			--valmundur-height: 0;
		}
	}
	html.menu-is-closed .MainMenu,
	html.menu-is-open .MainMenu {
		transition: (
			margin-top $menu-speed ease-in-out,
			visibility 0ms ($menu-speed + 100ms)
		);
	}
	html.menu-is-open .MainMenu {
		transition-delay: 0ms;
		visibility: visible;
		margin-top: 0;
	}

	html.menu-is-active .MainMenu::after {
		content: '';
		position: fixed;
		left: 0;
		right: 0;
		bottom: 0;
		height: 0;
		background: white url('/assets/valmundur-a-sundi.png') 50% 0% /
			var(--valmundur-width) auto repeat-x;
		transition: (
			height $swimmer-speed ease-out,
			visibility 0ms ($swimmer-speed + 100ms),
			background-size $swimmer-speed ease-in-out
		);
		visibility: hidden;
		box-shadow: 0 -35px 15px -10px white;
	}
	html.menu-is-open .MainMenu::after {
		transition-delay: 0ms;
		visibility: visible;
		height: var(--valmundur-height);
	}

	html.menu-is-active .MainMenu__items {
		padding-bottom: var(--valmundur-height);
	}
	html.menu-is-active .MainMenu__megas {
		margin-top: calc(-1 * var(--valmundur-height));
		padding-bottom: var(--valmundur-height);
	}

	.MainMenu__items {
		display: flex;
		flex-flow: row wrap;
		padding-top: var(--MainMenu__list--padTop, grid-units(3));
		margin-left: var(--MainMenu--offsetLeft);
	}
	.MainMenu__item {
		width: 100%;
		font-size: px($font-size-20);
	}
	.MainMenu__link {
		$pB: prem(8) - $link-underline-thickness;
		padding: prem(8) 0 $pB 0;
	}

	.MainMenu__separator[class] {
		display: block;
		margin-left: auto;
		order: -1;
	}
	.MainMenu__separator ~ .MainMenu__item {
		width: auto;
		order: -1;
		font-size: px($font-size-12);
		margin-left: grid-units(2);
		margin-bottom: 0;
		margin-top: calc(-0.5 * #{$var--Layout__header-height});
		transform: translateY(-50%)
			translateY(var(--MainMenu__list--padTop, grid-units(-3)));
	}

	.MainMenu__megas {
		margin-left: var(--MainMenu--offsetLeft);
	}
	html.menu-is-active .MainMenu__megapanel {
		display: none;
	}
	html.menu-is-active .MainMenu__megapanel--active,
	.MainMenu__megas[data-pristine='true'] > .MainMenu__megapanel--parent {
		display: block;
	}

	.MainMenu__megapanel {
		padding-top: grid-units(5);
	}

	.MainMenu__mega__title {
		@include SubheadingStyle--small;
	}
	html.menu-is-active .MainMenu__mega__title {
		@include sr-only();
	}
	.MainMenu__mega__item {
		margin-bottom: prem(19);
	}

	.MainMenu__mega__link {
		background-image: none !important;
	}
	[aria-current='true'] .MainMenu__mega__link::before {
		content: '';
		float: left;
		margin-left: prem(-24);
		width: prem(8);
		height: prem(2);
		margin-top: prem($font-base-leading / 2 - 1);
		background-color: currentColor;
	}

	.MainMenu__mega__link__summary {
		display: none;
	}

	.MainMenu__megapanel__backtomenu {
		display: none;
	}
}

// ===========================================================================

// ===========================================================================

@media #{$mq-Topmenu} {
	.MainMenu {
	}
	.MainMenu__items {
		position: absolute;
		z-index: $zIndex--header;
		top: 0;
		right: 0;
		left: cols_pct(3, 3);
		height: $var--Layout__header-height;
		margin: 0 prem(-20);
		@include media($mq-tablet) {
			left: 220px;
			margin: 0 between_tablet(-15, -20);
		}
		display: flex;
		justify-content: flex-end;
		align-items: center;
	}

	.MainMenu__separator[class] {
		display: block;
		margin-left: auto;
	}

	.MainMenu__item {
		margin: 0 prem(10);
	}

	.MainMenu__link {
		$pB: prem(10) - $link-underline-thickness;
		padding: prem(10) prem(10) $pB prem(10);
	}

	@include media($mq-tablet) {
		.MainMenu__link {
			padding-left: between_tablet(5, 10);
			padding-right: between_tablet(5, 10);
		}
		.MainMenu__item--search > .MainMenu__link {
			@include hideText(soft);
			box-sizing: content-box;
			width: 1em;
		}
		.MainMenu__item--search > .MainMenu__link::before {
			margin-right: prem(40);
		}
	}

	// ===========================================================================
	//
	// Mega Menu
	//
	// ===========================================================================

	.MainMenu__megapanel {
		margin: between_cols(30, 60) 0;
	}

	html.before-sprinkling .MainMenu__megapanel {
		display: none;
	}
	.MainMenu[data-sprinkled] > * > .MainMenu__megapanel {
		display: block;
		opacity: 0;
		visibility: hidden;
		transition: all 200ms ease-in-out;
		transition-property: opacity, visibility;

		position: absolute;
		z-index: $zIndex--header;
		top: $var--Layout__header-height;
		left: 0;
		right: 0;
		margin: 0;
		padding: between_cols(50, 150) 0;
		background-color: $color-suld-0;
	}
	.MainMenu[data-sprinkled] > * > .MainMenu__megapanel--active {
		opacity: 1;
		visibility: visible;
	}

	.MainMenu[data-sprinkled] > * > .MainMenu__megapanel::before {
		content: '';
		position: absolute;
		z-index: -1;
		top: 0;
		bottom: 0;
		left: calc(50% - 50vw);
		right: calc(50% - 50vw);
		background: inherit;
		border-top: 1px solid $color-suld-75;
		border-bottom: 1px solid $color-suld-50;
		box-shadow: 0 60px 100px -40px rgba(black, 0.03);
	}

	.MainMenu__mega__title {
		border-top: 1px solid $color-suld-75;
		padding-top: between_cols(30, 60);
		margin-bottom: prem(20);
		@include HeadingStyle--small();
	}
	.MainMenu[data-sprinkled] > * > * > .MainMenu__mega__title {
		@include sr-only();
	}

	.MainMenu__mega__items {
		display: grid;
		grid-auto-flow: row;
		gap: prem($grid-gutter) cols_pct(0, 1);
		grid-template-columns: repeat(4, 1fr);

		@include media($mq-tablet) {
			grid-template-columns: repeat(3, 1fr);
		}
	}
	.MainMenu__mega__item {
		display: flex;
		align-items: flex-end;
	}
	.MainMenu__mega__link[class] {
		@include LinkStyle_Reset(true);
		width: 100%;
		// @deprecated Remove this line in version 0.8
		background: -500px 0 no-repeat;
	}
	.MainMenu__mega__link::before {
		content: '';
		display: block;
		background: 0 50% / auto 100% no-repeat;
		// fall back to `inherit` to support old background-image on the link HTML pattern
		// @deprecated Remove `inherit` fallback in version 0.8
		background-image: var(--menu-item-icon, inherit);
		height: between_tablet_netbook(70, 100);
		margin-bottom: prem(10);

		@include media($mq-wide) {
			height: px(100);
		}
	}

	.MainMenu__mega__link__title {
		font-size: prem($font-size-20);
		@include setDefaultLinkVariables();
		@include LinkStyle--basic();
	}
	.MainMenu__mega__link:hover .MainMenu__mega__link__title,
	.MainMenu__mega__link:focus .MainMenu__mega__link__title,
	.MainMenu__mega__link:active .MainMenu__mega__link__title {
		@include LinkStyle--hover();
	}
	.MainMenu__mega__link:focus .MainMenu__mega__link__title {
		@include LinkStyle--focus();
	}

	.MainMenu__mega__link__summary {
		display: block;
		height: prem(2 * $font-base-leading);
		font-size: inherit; // override default <small> styling

		@include media($mq-tablet_netbook) {
			height: prem(3 * $font-base-leading);
		}
	}

	.MainMenu__megapanel__backtomenu {
		position: absolute;
		top: calc(0.5 * #{$var--grid-gutter});
		right: 0;
		margin-right: prem(-18);
		width: prem(50);
		line-height: prem(50);
		font-size: prem(14);
		opacity: 0.5;
		@include hideText(soft);
	}
	.MainMenu__megapanel__backtomenu:hover,
	.MainMenu__megapanel__backtomenu:focus,
	.MainMenu__megapanel__backtomenu:active {
		opacity: 1;
	}

	.MainMenu__megapanel__backtomenu::before {
		@include icon($icons-close-thin);
		width: 100%;
		margin-right: 1px;
	}
}

// ===========================================================================
// MainMenu "Greeting"
// ===========================================================================

@include media($mq-Hamburger) {
	.MainMenu[class][class] {
		display: flex;
		flex-flow: column;
	}
	.MainMenu__items--greetingHack[class][class] {
		order: -1;
		padding-bottom: 0;
	}

	.MainMenu:not([data-sprinkled]) > .MainMenu__greeting {
		display: none;
	}
	.MainMenu__greeting {
		max-height: 400px;
		margin-left: var(--MainMenu--offsetLeft);
		max-width: prem(240);
	}
	.MainMenu__greeting[hidden] {
		display: block;
		visibility: hidden;
		opacity: 0;
		max-height: 0;
		overflow: hidden;
		transition: (
			opacity 200ms 100ms,
			max-height 300ms ease-in-out,
			visibility 0ms (300ms + 100ms)
		);
	}
	.MainMenu__greeting > h3 {
		@include SubheadingStyle--small();
		margin-bottom: grid-units(2);
	}
	.MainMenu__greeting > p {
		padding-bottom: grid-units(2);
	}
}
@include media($mq-Topmenu) {
	.MainMenu__greeting {
		display: none;
	}
}

// ===========================================================================
//
// Markup Warnings
//
// ===========================================================================

@media screen {
	.MainMenu:not(nav) {
		@include WARNING__('Please use <nav/>');
	}
	.MainMenu:not([aria-label]):not([aria-labelledby]) {
		@include WARNING__('Please add `aria-label` or `aria-labelledby`');
	}
	.MainMenu[aria-labelledby] > .MainMenu__title:not([id]) {
		@include WARNING__('Please add `id` attribute');
	}
	.MainMenu__list:first-child {
		@include WARNING__('`.MainMenu__title` missing');
	}
	.MainMenu__item:first-child:not(.MainMenu__item--home) {
		@include WARNING__('Home link missing');
	}
}
